"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[849],{60849:function(_,B,a){a.d(B,{K:function(){return ae},z:function(){return X}});var k=a(97857),f=a.n(k),O=a(15009),m=a.n(O),j=a(99289),E=a.n(j),A=a(5574),$=a.n(A),T=a(67294),g=a(71613),D=a(14726),M=a(2453),v=a(26412),S=a(37476),P=a(86615),R=a(97462),i=a(62370),l=a(51390),u=a(64317),p=a(90672),n=a(17186),N=a(24739),K=a(5966),Q=a(32443),L=a(44815),W=a(59530),e=a(85893),X=function(y){var U=(0,W.useModel)("@@initialState"),G=U.initialState,J=G.users,F=T.useRef(),Z=T.useState(),h=$()(Z,2),V=h[0],C=h[1];return(0,e.jsxs)(S.Y,{modalProps:{mask:!1,maskClosable:!1,destroyOnClose:!0,onCancel:function(){var x=E()(m()().mark(function s(){var c,r;return m()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=(c=F.current)===null||c===void 0?void 0:c.getFieldValue("attachmentId"),!r){o.next=4;break}return o.next=4,(0,g.xB)(r[0].response.result);case 4:case"end":return o.stop()}},s)}));function d(){return x.apply(this,arguments)}return d}()},formRef:F,title:"\u6D41\u7A0B\u5BA1\u6279",layout:"horizontal",labelCol:{span:3},trigger:(0,e.jsx)(D.ZP,{type:y.link?"link":"primary",disabled:y.status||!y.taskId,children:"\u6267\u884C"}),request:E()(m()().mark(function x(){var d,s,c,r;return m()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return d={flowCommentType:"AGREE"},o.next=3,(0,g.vi)(y.taskId);case 3:return s=o.sent,c=s.success,r=s.result,c&&r&&(r.sequenceFlow.length&&(d.nodes=r.sequenceFlow),r.attributes.actions&&C(L.Us.filter(function(I){var b;return(b=r.attributes)===null||b===void 0?void 0:b.actions.some(function(z){return z===I.value})}))),o.abrupt("return",d);case 8:case"end":return o.stop()}},x)})),onFinish:function(){var x=E()(m()().mark(function d(s){var c,r,t,o,I,b;return m()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return r=s.commentContent,s.attachmentId&&(t=s.attachmentId[0],r=JSON.stringify({message:s.commentContent,filename:t.name}),c=t.response.result),o={},s.variables&&s.variables.length&&s.variables.forEach(function(Y){o[Y.key]=Y.value}),w.next=6,(0,g.t8)(f()(f()({},s),{},{commentContent:r,attachmentId:c,processInstanceId:y.processInstanceId,taskId:y.taskId,variables:o}));case 6:return I=w.sent,b=I.success,b&&(M.ZP.success("\u6267\u884C\u6210\u529F\uFF01"),y.reload()),w.abrupt("return",b);case 10:case"end":return w.stop()}},d)}));return function(d){return x.apply(this,arguments)}}(),children:[(0,e.jsx)(P.Z.Group,{name:"flowCommentType",label:"\u64CD\u4F5C",options:V||L.Us,rules:[{required:!0,message:"\u6267\u884C\u64CD\u4F5C\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(R.Z,{name:["flowCommentType"],children:function(d){var s=d.flowCommentType;if(s=="REJECT_TO_TASK")return(0,e.jsx)(i.Z,{name:"rejectToTaskId",label:"\u8282\u70B9",rules:[{required:!0,message:"\u9A73\u56DE\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(l.Z,{request:E()(m()().mark(function c(){var r,t,o;return m()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,g.p7)(y.processInstanceId);case 2:return r=b.sent,t=r.success,o=r.result,b.abrupt("return",{success:t,data:o||[]});case 6:case"end":return b.stop()}},c)})),search:!1,options:!1,pagination:!1,rowKey:"value",rowHoverable:!1,tableAlertRender:!1,rowSelection:{type:"radio",columnTitle:"\u9009\u62E9",columnWidth:80,onSelect:function(r){var t,o=r.value;(t=F.current)===null||t===void 0||t.setFieldValue("rejectToTaskId",o)}},columns:[{title:"\u8282\u70B9\u540D\u79F0",dataIndex:"label"},{title:"\u8282\u70B9key",dataIndex:"value"}]})});if(s=="DELEGATE"||s=="ASSIGN")return(0,e.jsx)(u.Z,{name:"userId",rules:[{required:!0,message:"\u6267\u884C\u4EBA\u4E0D\u80FD\u4E3A\u7A7A"}],label:"\u6267\u884C\u4EBA",request:function(){return J}})}}),(0,e.jsx)(p.Z,{label:"\u5BA1\u6279\u610F\u89C1",rules:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A"}],name:"commentContent"}),(0,e.jsx)(R.Z,{name:["nodes","flowCommentType"],children:function(d){var s=d.nodes,c=d.flowCommentType;if(s&&s.length&&c==="AGREE")return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.Z,{label:"\u76EE\u6807\u8282\u70B9",children:(0,e.jsx)(v.Z,{bordered:!0,size:"small",style:{width:"100%"},column:2,children:s.map(function(r,t){return(0,e.jsxs)(T.Fragment,{children:[(0,e.jsx)(v.Z.Item,{label:"\u76EE\u6807\u8282\u70B9",children:r.label}),(0,e.jsx)(v.Z.Item,{label:"\u8868\u8FBE\u5F0F",children:r.value})]},"nodes_"+t)})})}),(0,e.jsx)(n.u,{name:"variables",label:"\u6D41\u7A0B\u53D8\u91CF",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u6D41\u7A0B\u53D8\u91CF"},children:(0,e.jsxs)(N.UW,{children:[(0,e.jsx)(K.Z,{label:"key",name:"key",rules:[{required:!0,message:"\u6D41\u7A0B\u53D8\u91CFkey\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(K.Z,{label:"value",name:"value",rules:[{required:!0,message:"\u6D41\u7A0B\u53D8\u91CFvalue\u4E0D\u80FD\u4E3A\u7A7A"}]})]})})]})}}),(0,e.jsx)(Q.Z,{name:"attachmentId",fieldProps:{onRemove:function(){var x=E()(m()().mark(function s(c){var r,t;return m()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,g.xB)(c.response.result);case 2:return r=I.sent,t=r.success,I.abrupt("return",t);case 5:case"end":return I.stop()}},s)}));function d(s){return x.apply(this,arguments)}return d}()},label:"\u9644\u4EF6",max:1,action:(0,g.JD)(y.taskId,y.processInstanceId)})]})},q=a(66309),ee=[{label:"\u542F\u52A8\u6D41\u7A0B",value:"0",color:"lime"},{label:"\u540C\u610F",value:"1",color:"green"},{label:"\u62D2\u7EDD",value:"2",color:"purple"},{label:"\u64A4\u56DE",value:"3",color:"orange"},{label:"\u9A73\u56DE",value:"4",color:"magenta"},{label:"\u9A73\u56DE\u5230\u6307\u5B9A\u8282\u70B9",value:"5",color:"volcano"},{label:"\u59D4\u6D3E",value:"6",color:"blue"},{label:"\u8F6C\u529E",value:"7",color:"cyan"},{label:"\u7EC8\u6B62",value:"8",color:"red"},{label:"\u524D\u52A0\u7B7E",value:"9",color:"blue"},{label:"\u540E\u52A0\u7B7E",value:"10",color:"blue"},{label:"\u4F5C\u5E9F",value:"11",color:"red"},{label:"\u8BC4\u8BBA",value:"12",color:"geekblue"},{label:"\u91CD\u65B0\u63D0\u4EA4",value:"14",color:"lime"}],te=[{label:"\u540C\u610F",value:"AGREE"},{label:"\u8BC4\u8BBA",value:"ADD_COMMENT"},{label:"\u9A73\u56DE",value:"REJECT"},{label:"\u9A73\u56DE\u5230\u6307\u5B9A\u8282\u70B9",value:"REJECT_TO_TASK"},{label:"\u59D4\u6D3E",value:"DELEGATE"},{label:"\u8F6C\u529E",value:"ASSIGN"}],H=a(88859),ae=function(y){var U=y.comments,G=y.taskName,J=(0,W.useModel)("@@initialState"),F=J.initialState,Z=F.users;return(0,e.jsx)(S.Y,{submitter:{render:!1},title:"".concat(G,"-\u5BA1\u6279\u610F\u89C1"),trigger:(0,e.jsx)(D.ZP,{type:"text",style:{color:"#ff7a45"},children:"\u5BA1\u6279\u610F\u89C1"}),children:(0,e.jsx)("div",{style:{maxHeight:"600px",overflow:"auto",scrollbarWidth:"thin"},children:(0,e.jsx)(v.Z,{bordered:!0,size:"small",style:{width:"100%"},column:2,children:U.map(function(h,V){var C=ee.find(function(t){return t.value==h.flowCommentType}),x=h.commentContent,d;if(h.attachmentId){var s=JSON.parse(x);d=s.filename,x=s.message}var c=C.value=="0"||C.value=="14",r;return c&&h.ext&&(r=JSON.parse(h.ext).content),(0,e.jsxs)(T.Fragment,{children:[(0,e.jsx)(v.Z.Item,{label:"\u64CD\u4F5C\u7C7B\u578B",children:(0,e.jsx)(q.Z,{color:C.color,children:"".concat(C.label).concat(c?"-\u9644\u8868\u5355":"")})}),(0,e.jsx)(v.Z.Item,{label:"\u64CD\u4F5C\u4EBA",children:h.assigneeName}),(0,e.jsx)(v.Z.Item,{label:"\u64CD\u4F5C\u65F6\u95F4",children:h.commentTime}),(0,e.jsx)(v.Z.Item,{label:"\u53D8\u91CF\u4FE1\u606F",children:JSON.stringify(h.variables||{})}),C.value=="6"&&(0,e.jsx)(v.Z.Item,{label:"\u59D4\u6D3E\u4EBA",children:(0,e.jsx)(H.Ju,{mode:"read",text:h.userId,valueType:"select",request:function(){return Z}})}),C.value=="7"&&(0,e.jsx)(v.Z.Item,{label:"\u8F6C\u529E\u4EBA",children:(0,e.jsx)(H.Ju,{mode:"read",text:h.userId,valueType:"select",request:function(){return Z}})}),c&&r.map(function(t,o){return(0,e.jsxs)(T.Fragment,{children:[t.oldValue&&(0,e.jsx)(v.Z.Item,{label:"".concat(t.name,"(\u53D8\u66F4\u524D)"),children:t.isUrl?(0,e.jsx)("a",{href:t.oldValue,children:t.oldValue}):(0,e.jsx)("span",{children:t.oldValue})}),(0,e.jsx)(v.Z.Item,{label:"".concat(t.name).concat(t.oldValue?"(\u53D8\u66F4\u540E)":""),children:t.isUrl?(0,e.jsx)("a",{href:t.newValue,children:t.newValue}):(0,e.jsx)("span",{style:{color:t.oldValue?"#ffc069":"#91caff"},children:t.newValue})})]},"formObject_"+o)}),(0,e.jsx)(v.Z.Item,{span:3,label:"\u610F\u89C1",children:x}),d&&(0,e.jsx)(v.Z.Item,{span:3,label:"\u9644\u4EF6",children:(0,e.jsx)("a",{target:"_blank",href:(0,g.FG)(h.attachmentId),children:d})})]},"comments_"+h.taskId+V)})})})})}},71613:function(_,B,a){a.d(B,{FG:function(){return M},JD:function(){return v},Ud:function(){return D},p7:function(){return g},pb:function(){return E},t8:function(){return R},vi:function(){return P},xB:function(){return S},xg:function(){return $}});var k=a(15009),f=a.n(k),O=a(99289),m=a.n(O),j=a(59530);function E(i){return A.apply(this,arguments)}function A(){return A=m()(f()().mark(function i(l){return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,j.request)("/easy-flowable/processInstance/list/".concat(l)));case 1:case"end":return p.stop()}},i)})),A.apply(this,arguments)}var $=function(){var i=m()(f()().mark(function l(u){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,j.request)("/easy-flowable/processInstance/stateSet/".concat(u)));case 1:case"end":return n.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),T=null,g=function(){var i=m()(f()().mark(function l(u){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,j.request)("/easy-flowable/processInstance/backUserTasks/".concat(u)));case 1:case"end":return n.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),D=function(){var i=m()(f()().mark(function l(u){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,j.request)("/easy-flowable/processInstance/executionHistory/".concat(u)));case 1:case"end":return n.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),M=function(l){return"easy-flowable/task/getAttachment/".concat(l)},v=function(l,u){return"easy-flowable/task/addAttachment?taskId=".concat(l,"&processInstanceId=").concat(u)},S=function(){var i=m()(f()().mark(function l(u){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,j.request)("/easy-flowable/task/delAttachment/".concat(u)));case 1:case"end":return n.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),P=function(){var i=m()(f()().mark(function l(u){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,j.request)("/easy-flowable/task/nextNodeVariables/".concat(u)));case 1:case"end":return n.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),R=function(){var i=m()(f()().mark(function l(u){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,j.request)("/easy-flowable/task/execute",{method:"POST",data:u}));case 1:case"end":return n.stop()}},l)}));return function(u){return i.apply(this,arguments)}}()}}]);
