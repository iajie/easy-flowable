"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[849],{60849:function(Q,k,t){t.d(k,{K:function(){return ae},z:function(){return _}});var $=t(97857),v=t.n($),O=t(15009),c=t.n(O),j=t(99289),g=t.n(j),T=t(5574),M=t.n(T),w=t(67294),C=t(71613),F=t(14726),P=t(2453),h=t(26412),D=t(37476),U=t(86615),S=t(97462),i=t(62370),l=t(51390),u=t(64317),y=t(90672),r=t(17186),N=t(24739),K=t(5966),X=t(32443),L=t(44815),W=t(59530),e=t(85893),_=function(I){var G=(0,W.useModel)("@@initialState"),J=G.initialState,R=J.users,A=w.useRef(),V=w.useState(),Z=M()(V,2),B=Z[0],x=Z[1];return(0,e.jsxs)(D.Y,{modalProps:{mask:!1,maskClosable:!1,destroyOnClose:!0,onCancel:function(){var p=g()(c()().mark(function s(){var d,n;return c()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=(d=A.current)===null||d===void 0?void 0:d.getFieldValue("attachmentId"),!n){a.next=4;break}return a.next=4,(0,C.xB)(n[0].response.result);case 4:case"end":return a.stop()}},s)}));function f(){return p.apply(this,arguments)}return f}()},formRef:A,title:"\u6D41\u7A0B\u5BA1\u6279",layout:"horizontal",labelCol:{span:3},trigger:(0,e.jsx)(F.ZP,{type:I.link?"link":"primary",disabled:I.status||!I.taskId,children:"\u6267\u884C"}),request:g()(c()().mark(function p(){var f,s,d,n;return c()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return f={flowCommentType:"AGREE"},a.next=3,(0,C.vi)(I.taskId);case 3:return s=a.sent,d=s.success,n=s.result,d&&n&&(n.sequenceFlow.length&&(f.nodes=n.sequenceFlow),n.attributes.actions&&x(L.Us.filter(function(b){var o;return(o=n.attributes)===null||o===void 0?void 0:o.actions.some(function(z){return z===b.value})}))),a.abrupt("return",f);case 8:case"end":return a.stop()}},p)})),onFinish:function(){var p=g()(c()().mark(function f(s){var d,n,m,a,b,o;return c()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n=s.commentContent,s.attachmentId&&(m=s.attachmentId[0],n=JSON.stringify({message:s.commentContent,filename:m.name}),d=m.response.result),a={},s.variables&&s.variables.length&&s.variables.forEach(function(Y){a[Y.key]=Y.value}),E.next=6,(0,C.t8)(v()(v()({},s),{},{commentContent:n,attachmentId:d,processInstanceId:I.processInstanceId,taskId:I.taskId,variables:a}));case 6:return b=E.sent,o=b.success,o&&(P.ZP.success("\u6267\u884C\u6210\u529F\uFF01"),I.reload()),E.abrupt("return",o);case 10:case"end":return E.stop()}},f)}));return function(f){return p.apply(this,arguments)}}(),children:[(0,e.jsx)(U.Z.Group,{name:"flowCommentType",label:"\u64CD\u4F5C",options:B||L.Us,rules:[{required:!0,message:"\u6267\u884C\u64CD\u4F5C\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(S.Z,{name:["flowCommentType"],children:function(f){var s=f.flowCommentType;if(s=="REJECT_TO_TASK")return(0,e.jsx)(i.Z,{name:"rejectToTaskId",label:"\u8282\u70B9",rules:[{required:!0,message:"\u9A73\u56DE\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(l.Z,{request:g()(c()().mark(function d(){var n,m,a;return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,C.p7)(I.processInstanceId);case 2:return n=o.sent,m=n.success,a=n.result,o.abrupt("return",{success:m,data:a||[]});case 6:case"end":return o.stop()}},d)})),search:!1,options:!1,pagination:!1,rowKey:"value",rowHoverable:!1,tableAlertRender:!1,rowSelection:{type:"radio",columnTitle:"\u9009\u62E9",columnWidth:80,onSelect:function(n){var m,a=n.value;(m=A.current)===null||m===void 0||m.setFieldValue("rejectToTaskId",a)}},columns:[{title:"\u8282\u70B9\u540D\u79F0",dataIndex:"label"},{title:"\u8282\u70B9key",dataIndex:"value"}]})});if(s=="DELEGATE"||s=="ASSIGN")return(0,e.jsx)(u.Z,{name:"userId",rules:[{required:!0,message:"\u6267\u884C\u4EBA\u4E0D\u80FD\u4E3A\u7A7A"}],label:"\u6267\u884C\u4EBA",request:function(){return R}})}}),(0,e.jsx)(y.Z,{label:"\u5BA1\u6279\u610F\u89C1",rules:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A"}],name:"commentContent"}),(0,e.jsx)(S.Z,{name:["nodes","flowCommentType"],children:function(f){var s=f.nodes,d=f.flowCommentType;if(s&&s.length&&d==="AGREE")return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.Z,{label:"\u76EE\u6807\u8282\u70B9",children:(0,e.jsx)(h.Z,{bordered:!0,size:"small",style:{width:"100%"},column:2,children:s.map(function(n,m){return(0,e.jsxs)(w.Fragment,{children:[(0,e.jsx)(h.Z.Item,{label:"\u76EE\u6807\u8282\u70B9",children:n.label}),(0,e.jsx)(h.Z.Item,{label:"\u8868\u8FBE\u5F0F",children:n.value})]},"nodes_"+m)})})}),(0,e.jsx)(r.u,{name:"variables",label:"\u6D41\u7A0B\u53D8\u91CF",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u6D41\u7A0B\u53D8\u91CF"},children:(0,e.jsxs)(N.UW,{children:[(0,e.jsx)(K.Z,{label:"key",name:"key",rules:[{required:!0,message:"\u6D41\u7A0B\u53D8\u91CFkey\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(K.Z,{label:"value",name:"value",rules:[{required:!0,message:"\u6D41\u7A0B\u53D8\u91CFvalue\u4E0D\u80FD\u4E3A\u7A7A"}]})]})})]})}}),(0,e.jsx)(X.Z,{name:"attachmentId",fieldProps:{onRemove:function(){var p=g()(c()().mark(function s(d){var n,m;return c()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,C.xB)(d.response.result);case 2:return n=b.sent,m=n.success,b.abrupt("return",m);case 5:case"end":return b.stop()}},s)}));function f(s){return p.apply(this,arguments)}return f}()},label:"\u9644\u4EF6",max:1,action:(0,C.JD)(I.taskId,I.processInstanceId)})]})},q=t(66309),ee=[{label:"\u542F\u52A8\u6D41\u7A0B",value:"0",color:"lime"},{label:"\u540C\u610F",value:"1",color:"green"},{label:"\u62D2\u7EDD",value:"2",color:"purple"},{label:"\u64A4\u56DE",value:"3",color:"orange"},{label:"\u9A73\u56DE",value:"4",color:"magenta"},{label:"\u9A73\u56DE\u5230\u6307\u5B9A\u8282\u70B9",value:"5",color:"volcano"},{label:"\u59D4\u6D3E",value:"6",color:"blue"},{label:"\u8F6C\u529E",value:"7",color:"cyan"},{label:"\u7EC8\u6B62",value:"8",color:"red"},{label:"\u524D\u52A0\u7B7E",value:"9",color:"blue"},{label:"\u540E\u52A0\u7B7E",value:"10",color:"blue"},{label:"\u4F5C\u5E9F",value:"11",color:"red"},{label:"\u8BC4\u8BBA",value:"12",color:"geekblue"},{label:"\u91CD\u65B0\u63D0\u4EA4",value:"14",color:"lime"}],te=[{label:"\u540C\u610F",value:"AGREE"},{label:"\u8BC4\u8BBA",value:"ADD_COMMENT"},{label:"\u9A73\u56DE",value:"REJECT"},{label:"\u9A73\u56DE\u5230\u6307\u5B9A\u8282\u70B9",value:"REJECT_TO_TASK"},{label:"\u59D4\u6D3E",value:"DELEGATE"},{label:"\u8F6C\u529E",value:"ASSIGN"}],H=t(88859),ae=function(I){var G=I.comments,J=I.taskName,R=I.form,A=R===void 0?!0:R,V=(0,W.useModel)("@@initialState"),Z=V.initialState,B=Z.users;return(0,e.jsx)(D.Y,{modalProps:{destroyOnClose:!0},submitter:{render:!1},title:"".concat(J,"-\u5BA1\u6279\u610F\u89C1"),trigger:(0,e.jsx)(F.ZP,{type:"text",style:{color:"#ff7a45"},children:"\u5BA1\u6279\u610F\u89C1"}),children:(0,e.jsx)("div",{style:{maxHeight:"600px",overflow:"auto",scrollbarWidth:"thin"},children:(0,e.jsx)(h.Z,{bordered:!0,size:"small",style:{width:"100%"},column:2,children:G.map(function(x){var p=ee.find(function(a){return a.value==x.flowCommentType}),f=x.commentContent,s;if(x.attachmentId){var d=JSON.parse(f);s=d.filename,f=d.message}var n=(p.value=="0"||p.value=="14")&&A,m;return n&&x.ext&&(m=JSON.parse(x.ext).content),(0,e.jsxs)(w.Fragment,{children:[(0,e.jsx)(h.Z.Item,{label:"\u64CD\u4F5C\u7C7B\u578B",children:(0,e.jsx)(q.Z,{color:p.color,children:"".concat(p.label).concat(n?"-\u9644\u8868\u5355":"")})}),(0,e.jsx)(h.Z.Item,{label:"\u64CD\u4F5C\u4EBA",children:x.assigneeName}),(0,e.jsx)(h.Z.Item,{label:"\u64CD\u4F5C\u65F6\u95F4",children:x.commentTime}),(0,e.jsx)(h.Z.Item,{label:"\u53D8\u91CF\u4FE1\u606F",children:JSON.stringify(x.variables||{})}),p.value=="6"&&(0,e.jsx)(h.Z.Item,{label:"\u59D4\u6D3E\u4EBA",children:(0,e.jsx)(H.Ju,{mode:"read",text:x.userId,valueType:"select",request:g()(c()().mark(function a(){return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",B);case 1:case"end":return o.stop()}},a)}))})}),p.value=="7"&&(0,e.jsx)(h.Z.Item,{label:"\u8F6C\u529E\u4EBA",children:(0,e.jsx)(H.Ju,{mode:"read",text:x.userId,valueType:"select",request:g()(c()().mark(function a(){return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",B);case 1:case"end":return o.stop()}},a)}))})}),n&&m.map(function(a,b){return(0,e.jsxs)(w.Fragment,{children:[a.oldValue&&(0,e.jsx)(h.Z.Item,{label:"".concat(a.name,"(\u53D8\u66F4\u524D)"),children:a.isUrl?(0,e.jsx)("a",{href:a.oldValue,children:a.oldValue}):(0,e.jsx)("span",{children:a.oldValue})}),(0,e.jsx)(h.Z.Item,{label:"".concat(a.name).concat(a.oldValue?"(\u53D8\u66F4\u540E)":""),children:a.isUrl?(0,e.jsx)("a",{href:a.newValue,children:a.newValue}):(0,e.jsx)("span",{style:{color:a.oldValue?"#ffc069":"#91caff"},children:a.newValue})})]},"formObject_"+Math.random()+b)}),(0,e.jsx)(h.Z.Item,{span:3,label:"\u610F\u89C1",children:f}),s&&(0,e.jsx)(h.Z.Item,{span:3,label:"\u9644\u4EF6",children:(0,e.jsx)("a",{target:"_blank",href:(0,C.FG)(x.attachmentId),children:s})})]},"comments_"+x.commentId)})})})})}},71613:function(Q,k,t){t.d(k,{FG:function(){return P},JD:function(){return h},Ud:function(){return F},p7:function(){return C},pb:function(){return g},t8:function(){return S},vi:function(){return U},xB:function(){return D},xg:function(){return M}});var $=t(15009),v=t.n($),O=t(99289),c=t.n(O),j=t(59530);function g(i){return T.apply(this,arguments)}function T(){return T=c()(v()().mark(function i(l){return v()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,j.request)("/easy-flowable/processInstance/list/".concat(l)));case 1:case"end":return y.stop()}},i)})),T.apply(this,arguments)}var M=function(){var i=c()(v()().mark(function l(u){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,j.request)("/easy-flowable/processInstance/stateSet/".concat(u)));case 1:case"end":return r.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),w=null,C=function(){var i=c()(v()().mark(function l(u){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,j.request)("/easy-flowable/processInstance/backUserTasks/".concat(u)));case 1:case"end":return r.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),F=function(){var i=c()(v()().mark(function l(u){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,j.request)("/easy-flowable/processInstance/executionHistory/".concat(u)));case 1:case"end":return r.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),P=function(l){return"easy-flowable/task/getAttachment/".concat(l)},h=function(l,u){return"easy-flowable/task/addAttachment?taskId=".concat(l,"&processInstanceId=").concat(u)},D=function(){var i=c()(v()().mark(function l(u){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,j.request)("/easy-flowable/task/delAttachment/".concat(u)));case 1:case"end":return r.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),U=function(){var i=c()(v()().mark(function l(u){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,j.request)("/easy-flowable/task/nextNodeVariables/".concat(u)));case 1:case"end":return r.stop()}},l)}));return function(u){return i.apply(this,arguments)}}(),S=function(){var i=c()(v()().mark(function l(u){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,j.request)("/easy-flowable/task/execute",{method:"POST",data:u}));case 1:case"end":return r.stop()}},l)}));return function(u){return i.apply(this,arguments)}}()}}]);
