"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[849],{60849:function(Q,$,n){n.d($,{K:function(){return ae},z:function(){return X}});var O=n(97857),d=n.n(O),M=n(15009),c=n.n(M),g=n(99289),j=n.n(g),T=n(5574),P=n.n(T),C=n(67294),x=n(71613),D=n(14726),G=n(2453),h=n(26412),F=n(37476),U=n(86615),S=n(97462),Z=n(62370),J=n(51390),i=n(64317),t=n(90672),s=n(17186),p=n(24739),a=n(5966),L=n(32443),W=n(44815),H=n(59530),e=n(85893),X=function(I){var V=(0,H.useModel)("@@initialState"),N=V.initialState,R=N.users,A=C.useRef(),K=C.useState(),k=P()(K,2),B=k[0],w=k[1];return(0,e.jsxs)(F.Y,{modalProps:{mask:!1,maskClosable:!1,destroyOnClose:!0,onCancel:function(){var b=j()(c()().mark(function u(){var m,l;return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(l=(m=A.current)===null||m===void 0?void 0:m.getFieldValue("attachmentId"),!l){r.next=4;break}return r.next=4,(0,x.xB)(l[0].response.result);case 4:case"end":return r.stop()}},u)}));function v(){return b.apply(this,arguments)}return v}()},formRef:A,title:"\u6D41\u7A0B\u5BA1\u6279",layout:"horizontal",labelCol:{span:3},trigger:(0,e.jsx)(D.ZP,{type:I.link?"link":"primary",disabled:I.status||!I.taskId,children:"\u6267\u884C"}),request:j()(c()().mark(function b(){var v,u,m,l;return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return v={flowCommentType:"AGREE"},r.next=3,(0,x.vi)(I.taskId);case 3:return u=r.sent,m=u.success,l=u.result,m&&l&&(l.sequenceFlow.length&&(v.nodes=l.sequenceFlow),l.attributes.actions&&w(W.Us.filter(function(y){var o;return(o=l.attributes)===null||o===void 0?void 0:o.actions.some(function(Y){return Y===y.value})}))),r.abrupt("return",v);case 8:case"end":return r.stop()}},b)})),onFinish:function(){var b=j()(c()().mark(function v(u){var m,l,f,r,y,o;return c()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return l=u.commentContent,u.attachmentId&&(f=u.attachmentId[0],l=JSON.stringify({message:u.commentContent,filename:f.name}),m=f.response.result),r={},u.variables&&u.variables.length&&u.variables.forEach(function(_){r[_.key]=_.value}),E.next=6,(0,x.t8)(d()(d()({},u),{},{commentContent:l,attachmentId:m,processInstanceId:I.processInstanceId,taskId:I.taskId,variables:r}));case 6:return y=E.sent,o=y.success,o&&(G.ZP.success("\u6267\u884C\u6210\u529F\uFF01"),I.reload()),E.abrupt("return",o);case 10:case"end":return E.stop()}},v)}));return function(v){return b.apply(this,arguments)}}(),children:[(0,e.jsx)(U.Z.Group,{name:"flowCommentType",label:"\u64CD\u4F5C",options:B||W.Us,rules:[{required:!0,message:"\u6267\u884C\u64CD\u4F5C\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(S.Z,{name:["flowCommentType"],children:function(v){var u=v.flowCommentType;if(u=="REJECT_TO_TASK")return(0,e.jsx)(Z.Z,{name:"rejectToTaskId",label:"\u8282\u70B9",rules:[{required:!0,message:"\u9A73\u56DE\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(J.Z,{request:j()(c()().mark(function m(){var l,f,r;return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,x.p7)(I.processInstanceId);case 2:return l=o.sent,f=l.success,r=l.result,o.abrupt("return",{success:f,data:r||[]});case 6:case"end":return o.stop()}},m)})),search:!1,options:!1,pagination:!1,rowKey:"value",rowHoverable:!1,tableAlertRender:!1,rowSelection:{type:"radio",columnTitle:"\u9009\u62E9",columnWidth:80,onSelect:function(l){var f,r=l.value;(f=A.current)===null||f===void 0||f.setFieldValue("rejectToTaskId",r)}},columns:[{title:"\u8282\u70B9\u540D\u79F0",dataIndex:"label"},{title:"\u8282\u70B9key",dataIndex:"value"}]})});if(u=="DELEGATE"||u=="ASSIGN")return(0,e.jsx)(i.Z,{name:"userId",rules:[{required:!0,message:"\u6267\u884C\u4EBA\u4E0D\u80FD\u4E3A\u7A7A"}],label:"\u6267\u884C\u4EBA",request:function(){return R}})}}),(0,e.jsx)(t.Z,{label:"\u5BA1\u6279\u610F\u89C1",rules:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A"}],name:"commentContent"}),(0,e.jsx)(S.Z,{name:["nodes","flowCommentType"],children:function(v){var u=v.nodes,m=v.flowCommentType;if(u&&u.length&&m==="AGREE")return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Z.Z,{label:"\u76EE\u6807\u8282\u70B9",children:(0,e.jsx)(h.Z,{bordered:!0,size:"small",style:{width:"100%"},column:2,children:u.map(function(l,f){return(0,e.jsxs)(C.Fragment,{children:[(0,e.jsx)(h.Z.Item,{label:"\u76EE\u6807\u8282\u70B9",children:l.label}),(0,e.jsx)(h.Z.Item,{label:"\u8868\u8FBE\u5F0F",children:l.value})]},"nodes_"+f)})})}),(0,e.jsx)(s.u,{name:"variables",label:"\u6D41\u7A0B\u53D8\u91CF",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u6D41\u7A0B\u53D8\u91CF"},children:(0,e.jsxs)(p.UW,{children:[(0,e.jsx)(a.Z,{label:"key",name:"key",rules:[{required:!0,message:"\u6D41\u7A0B\u53D8\u91CFkey\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(a.Z,{label:"value",name:"value",rules:[{required:!0,message:"\u6D41\u7A0B\u53D8\u91CFvalue\u4E0D\u80FD\u4E3A\u7A7A"}]})]})})]})}}),(0,e.jsx)(L.Z,{name:"attachmentId",fieldProps:{onRemove:function(){var b=j()(c()().mark(function u(m){var l,f;return c()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,x.xB)(m.response.result);case 2:return l=y.sent,f=l.success,y.abrupt("return",f);case 5:case"end":return y.stop()}},u)}));function v(u){return b.apply(this,arguments)}return v}()},label:"\u9644\u4EF6",max:1,action:(0,x.JD)(I.taskId,I.processInstanceId)})]})},q=n(66309),ee=[{label:"\u542F\u52A8\u6D41\u7A0B",value:"0",color:"lime"},{label:"\u540C\u610F",value:"1",color:"green"},{label:"\u62D2\u7EDD",value:"2",color:"purple"},{label:"\u64A4\u56DE",value:"3",color:"orange"},{label:"\u9A73\u56DE",value:"4",color:"magenta"},{label:"\u9A73\u56DE\u5230\u6307\u5B9A\u8282\u70B9",value:"5",color:"volcano"},{label:"\u59D4\u6D3E",value:"6",color:"blue"},{label:"\u8F6C\u529E",value:"7",color:"cyan"},{label:"\u7EC8\u6B62",value:"8",color:"red"},{label:"\u524D\u52A0\u7B7E",value:"9",color:"blue"},{label:"\u540E\u52A0\u7B7E",value:"10",color:"blue"},{label:"\u4F5C\u5E9F",value:"11",color:"red"},{label:"\u8BC4\u8BBA",value:"12",color:"geekblue"},{label:"\u91CD\u65B0\u63D0\u4EA4",value:"14",color:"lime"}],re=[{label:"\u540C\u610F",value:"AGREE"},{label:"\u8BC4\u8BBA",value:"ADD_COMMENT"},{label:"\u9A73\u56DE",value:"REJECT"},{label:"\u9A73\u56DE\u5230\u6307\u5B9A\u8282\u70B9",value:"REJECT_TO_TASK"},{label:"\u59D4\u6D3E",value:"DELEGATE"},{label:"\u8F6C\u529E",value:"ASSIGN"}],z=n(88859),ae=function(I){var V=I.comments,N=I.taskName,R=I.form,A=R===void 0?!0:R,K=(0,H.useModel)("@@initialState"),k=K.initialState,B=k.users;return(0,e.jsx)(F.Y,{modalProps:{destroyOnClose:!0},submitter:{render:!1},title:"".concat(N,"-\u5BA1\u6279\u610F\u89C1"),trigger:(0,e.jsx)(D.ZP,{type:"text",style:{color:"#ff7a45"},children:"\u5BA1\u6279\u610F\u89C1"}),children:(0,e.jsx)("div",{style:{maxHeight:"600px",overflow:"auto",scrollbarWidth:"thin"},children:(0,e.jsx)(h.Z,{bordered:!0,size:"small",style:{width:"100%"},column:2,children:V.map(function(w){var b=ee.find(function(r){return r.value==w.flowCommentType}),v=w.commentContent,u;if(w.attachmentId){var m=JSON.parse(v);u=m.filename,v=m.message}var l=(b.value=="0"||b.value=="14")&&A,f;return l&&w.ext&&(f=JSON.parse(w.ext).content),(0,e.jsxs)(C.Fragment,{children:[(0,e.jsx)(h.Z.Item,{label:"\u64CD\u4F5C\u7C7B\u578B",children:(0,e.jsx)(q.Z,{color:b.color,children:"".concat(b.label).concat(l?"-\u9644\u8868\u5355":"")})}),(0,e.jsx)(h.Z.Item,{label:"\u64CD\u4F5C\u4EBA",children:w.assigneeName}),(0,e.jsx)(h.Z.Item,{label:"\u64CD\u4F5C\u65F6\u95F4",children:w.commentTime}),(0,e.jsx)(h.Z.Item,{label:"\u53D8\u91CF\u4FE1\u606F",children:JSON.stringify(w.variables||{})}),b.value=="6"&&(0,e.jsx)(h.Z.Item,{label:"\u59D4\u6D3E\u4EBA",children:(0,e.jsx)(z.Ju,{mode:"read",text:w.userId,valueType:"select",request:j()(c()().mark(function r(){return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",B);case 1:case"end":return o.stop()}},r)}))})}),b.value=="7"&&(0,e.jsx)(h.Z.Item,{label:"\u8F6C\u529E\u4EBA",children:(0,e.jsx)(z.Ju,{mode:"read",text:w.userId,valueType:"select",request:j()(c()().mark(function r(){return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",B);case 1:case"end":return o.stop()}},r)}))})}),l&&f.map(function(r,y){return(0,e.jsxs)(C.Fragment,{children:[r.oldValue&&(0,e.jsx)(h.Z.Item,{label:"".concat(r.name,"(\u53D8\u66F4\u524D)"),children:r.isUrl?(0,e.jsx)("a",{href:r.oldValue,children:r.oldValue}):(0,e.jsx)("span",{children:r.oldValue})}),(0,e.jsx)(h.Z.Item,{label:"".concat(r.name).concat(r.oldValue?"(\u53D8\u66F4\u540E)":""),children:r.isUrl?(0,e.jsx)("a",{href:r.newValue,children:r.newValue}):(0,e.jsx)("span",{style:{color:r.oldValue?"#ffc069":"#91caff"},children:r.newValue})})]},"formObject_"+Math.random()+y)}),(0,e.jsx)(h.Z.Item,{span:3,label:"\u610F\u89C1",children:v}),u&&(0,e.jsx)(h.Z.Item,{span:3,label:"\u9644\u4EF6",children:(0,e.jsx)("a",{target:"_blank",href:(0,x.FG)(w.attachmentId),children:u})})]},"comments_"+w.commentId)})})})})}},71613:function(Q,$,n){n.d($,{FG:function(){return G},JD:function(){return h},Ud:function(){return D},ZZ:function(){return Z},hM:function(){return J},p7:function(){return x},pb:function(){return j},t8:function(){return S},vi:function(){return U},xB:function(){return F},xg:function(){return P}});var O=n(15009),d=n.n(O),M=n(99289),c=n.n(M),g=n(59530);function j(i){return T.apply(this,arguments)}function T(){return T=c()(d()().mark(function i(t){return d()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,g.request)("/easy-flowable/processInstance/list/".concat(t)));case 1:case"end":return p.stop()}},i)})),T.apply(this,arguments)}var P=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/processInstance/stateSet/".concat(s)));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}(),C=null,x=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/processInstance/backUserTasks/".concat(s)));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}(),D=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/processInstance/executionHistory/".concat(s)));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}(),G=function(t){return"easy-flowable/task/getAttachment/".concat(t)},h=function(t,s){return"easy-flowable/task/addAttachment?taskId=".concat(t,"&processInstanceId=").concat(s)},F=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/task/delAttachment/".concat(s)));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}(),U=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/task/nextNodeVariables/".concat(s)));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}(),S=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/task/execute",{method:"POST",data:s}));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}(),Z=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/processInstance/processDynamics",{method:"GET",params:s}));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}(),J=function(){var i=c()(d()().mark(function t(s){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,g.request)("/easy-flowable/processInstance/nodeInfo/".concat(s)));case 1:case"end":return a.stop()}},t)}));return function(s){return i.apply(this,arguments)}}()}}]);
